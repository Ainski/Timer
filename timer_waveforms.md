# 定时器模块 - 完整设计与波形分析

## 模块接口

### 输入信号:
- `clk` - 时钟信号
- `write` - 写使能信号
- `up` - 向上/向下计数控制 (0=向下计数, 1=向上计数)
- `cut` - 计数控制信号
- `insec` - 输入秒值
- `inmin` - 输入分值
- `inhour` - 输入时值
- `start` - 启动/停止控制信号

### 输出信号:
- `sec` - 当前秒值 (输出)
- `min` - 当前分值
- `hour` - 当前时值
- `alarm` - 报警输出信号
- `counting#` - 计数状态指示器

## 内部中间关键信号

### 控制逻辑:
- `load_enable` - 加载使能信号
- `count_direction` - 计数方向（向上/向下）
- `update_seconds` - 秒更新信号
- `update_minutes` - 分更新信号
- `update_hours` - 时更新信号

### 溢出检测:
- `overflow_sec` - 秒溢出信号 (向上计数时达到59，向下计数时达到0)
- `overflow_min` - 分溢出信号 (向上计数时达到59，向下计数时达到0)
- `overflow_hour` - 时溢出信号 (向上计数时达到23，向下计数时达到0)

### 存储单元:
- `preset_sec` - 预设秒值
- `preset_min` - 预设分值
- `preset_hour` - 预设时值

### 计数器:
- `current_second` - 当前秒计数
- `current_minute` - 当前分计数
- `current_hour` - 当前时计数

### 状态信号:
- `counting_status` - 计数状态
- `alarm_condition` - 报警条件

## 波形图

### 1. 纯正向计时模式
```ts
{signal: [
  // 输入信号
  {name: 'clk', wave: 'p.....|....|..|..........'},
  {name: 'write', wave: '0.....|....|..|..........'},
  {name: 'up', wave: '1.....|....|..|..........'},
  {name: 'cut', wave: '101...|....|..|..........'},
  {name: 'insec', wave: 'x.....|....|..|..........'},
  {name: 'inmin', wave: 'x.....|....|..|..........'},
  {name: 'inhour', wave: 'x.....|....|..|..........'},
  {name: 'start', wave: '0.10..|....|..|..........'},

  // 内部信号
  {name: 'count_direction', wave: '1.....|....|..|..........'},
  {name: 'counting_status', wave: '01.0..|....|..|..........'},
  {name: 'current_second', wave: '=...==|====|==|==========', data: ['0','1','','59','0','1','','59']},
  {name: 'current_minute', wave: '=.....|.=..|=.|==========', data: ['0','1','','59']},
  {name: 'current_hour', wave: '=.....|....|..|=.......==', data: ['0','1']},
  {name: 'overflow_sec', wave: '0...10|1...|0.|..........'},
  {name: 'overflow_min', wave: '0.....|0.10|..|..........'},

  // 输出信号
  {name: 'sec', wave: '=...==|====|==|==========', data: ['0','1','','59','0','1','','59']},
  {name: 'min', wave: '=.....|.=..|=.|==========', data: ['0','1','','59']},
  {name: 'hour', wave: '=.....|....|..|=.......==', data: ['0','1']},
  {name: 'alarm', wave: '0.....|....|..|..........'},
  {name: 'counting#', wave: '01.0..|....|..|..........'}
]}
```

### 2. 设置正向计时模式
```ts
{signal: [
  // 输入信号
  {name: 'clk', wave: 'p...|...|....|.........'},
  {name: 'write', wave: '0.10..|.10|....|.........'},
  {name: 'up', wave: '0.10..|...|....|.........'},
  {name: 'cut', wave: '101...|...|....|.........'},
  {name: 'insec', wave: '0.30..|.=0|....|.........', data: ['10','1']},
  {name: 'inmin', wave: '0.30..|.=0|....|.........', data: ['5','1']},
  {name: 'inhour', wave: '0.30..|.=0|....|.........', data: ['1','1']},
  {name: 'start', wave: '0.10..|.10|....|.........'},

  // 内部信号
  {name: 'load_enable', wave: '0.1.0.|...|....|.........'},
  {name: 'count_direction', wave: '0.1.0.|.1.|0...|.........', data: ['down','up','down','up']},
  {name: 'preset_sec', wave: 'x...=|=.x|....|.........', data: ['10','1']},
  {name: 'preset_min', wave: 'x...=|=.x|....|.........', data: ['5','1']},
  {name: 'preset_hour', wave: 'x...=|=.x|....|.........', data: ['1','1']},
  {name: 'current_second', wave: '0..===|===|====|.........', data: ['0','1','','59']},
  {name: 'current_minute', wave: '0..=..|.==|====|.........', data: ['0','1','','59']},
  {name: 'current_hour', wave: '0..=..|...|.=..|.........', data: ['0','1']},
  {name: 'update_seconds', wave: '01.0..|1..|0...|.........'},

  // 输出信号
  {name: 'sec', wave: '0..===|===|====|.........', data: ['0','1','','59']},
  {name: 'min', wave: '0..=..|.==|====|.........', data: ['0','1','','59']},
  {name: 'hour', wave: '0..=..|...|.=..|.........', data: ['0','1']},
  {name: 'alarm', wave: '0.....|...|.10.|.........'},
  {name: 'counting#', wave: '01.0..|...|..1.|.........'}
]}
```

### 3. 设置倒计时模式
```ts
{signal: [
  // 输入信号
  {name: 'clk', wave: 'p......|...|....|.........'},
  {name: 'write', wave: '0.10...|.10|....|.........'},
  {name: 'up', wave: '0.10...|...|....|.........'},
  {name: 'cut', wave: '101....|...|....|.........'},
  {name: 'insec', wave: '0.30...|.=0|....|.........', data: ['10','1']},
  {name: 'inmin', wave: '0.30...|.=0|....|.........', data: ['5','1']},
  {name: 'inhour', wave: '0.30...|.=0|....|.........', data: ['1','1']},
  {name: 'start', wave: '0.10...|.10|....|.........'},

  // 内部信号
  {name: 'load_enable', wave: '0.1.0..|...|....|.........'},
  {name: 'count_direction', wave: '0.1.0..|1.0|....|.........', data: ['down','up','down']},
  {name: 'preset_sec', wave: 'x...=..|=.x|....|.........', data: ['10','1']},
  {name: 'preset_min', wave: 'x...=..|=.x|....|.........', data: ['5','1']},
  {name: 'preset_hour', wave: 'x...=..|=.x|....|.........', data: ['1','1']},
  {name: 'current_second', wave: '0..====|===|=0..|.........', data: ['0','59','58','','0']},
  {name: 'current_minute', wave: '0..==..|.==|=0..|.........', data: ['0','59','58','','0']},
  {name: 'current_hour', wave: '0..==..|...|.0..|.........', data: ['1','0']},
  {name: 'overflow_sec', wave: '0..1.0.|.1.|0...|.........'},

  // 输出信号
  {name: 'sec', wave: '0..====|===|=0..|.........', data: ['0','59','58','','0']},
  {name: 'min', wave: '0..==..|.==|=0..|.........', data: ['0','59','58','','0']},
  {name: 'hour', wave: '0..==..|...|.0..|.........', data: ['1','0']},
  {name: 'alarm', wave: '0......|...|.10.|.........'},
  {name: 'counting#', wave: '01.0...|...|..1.|.........'}
]}
```

### 4. 中断或重置模式
```ts
{signal: [
  // 输入信号
  {name: 'clk', wave: 'p....|...|..|........'},
  {name: 'write', wave: '10...|...|..|........'},
  {name: 'up', wave: '10...|...|..|........'},
  {name: 'cut', wave: '1......01...|..|........'},
  {name: 'insec', wave: '3x...|...|..|........', data: ['10']},
  {name: 'inmin', wave: '3x...|...|..|........', data: ['5']},
  {name: 'inhour', wave: '3x...|...|..|........', data: ['1']},
  {name: 'start', wave: '10...|...|..|........'},

  // 内部信号
  {name: 'load_enable', wave: '1.0..|...|..|........'},
  {name: 'count_direction', wave: '10...|...|0.|........', data: ['up','stop']},
  {name: 'current_second', wave: '0====|==0|..|........', data: ['0','59','58','','0']},
  {name: 'current_minute', wave: '0==....=0|..|........', data: ['0','59','58','','0']},
  {name: 'current_hour', wave: '0==.....0|..|........', data: ['1','0']},
  {name: 'counting_status', wave: '10...|...|..|........'},

  // 输出信号
  {name: 'sec', wave: '0====|==0|..|........', data: ['0','59','58','','0']},
  {name: 'min', wave: '0==....=0|..|........', data: ['0','59','58','','0']},
  {name: 'hour', wave: '0==.....0|..|........', data: ['1','0']},
  {name: 'alarm', wave: '0........|..|........'},
  {name: 'counting#', wave: '10.......|..|........'},
  {name: 'ok', wave: '10......1.|0.|........'}
]}
```

## 实现说明

1. `cut` 信号作为控制信号，影响计数行为。
2. `up` 信号决定计数器是向上计数 (1) 还是向下计数 (0)。
3. `write` 信号用于加载新时间值。
4. `start` 信号控制计数的开始/停止。
5. 向下计数时，当时间到达零时触发报警。
6. 向上计数时，当到达预设值时触发报警（如果配置）。

内部信号帮助管理不同操作模式并为定时器模块的正确操作提供清晰的状态转换。